<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Make a Event 4.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#ffffff; --panel:#f6f7fb; --text:#0b1220; --muted:#5b6b78; --accent:#0066ff; --card:#ffffff; --glass: rgba(10,10,10,0.04);
}
[data-theme="dark"]{
  --bg:#0b0f14; --panel:#0e1317; --text:#e8eef6; --muted:#9fb0c3; --accent:#00aaff; --card:#0b1115; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);min-height:100vh;display:flex;gap:18px;padding:18px;}
.app{width:100%;display:grid;grid-template-columns:380px 1fr;gap:18px;margin:auto;max-width:1200px;}
.panel{background:var(--panel);border-radius:12px;padding:16px;box-shadow:0 6px 20px var(--glass);display:flex;flex-direction:column;gap:12px;}
.header{display:flex;align-items:center;justify-content:space-between;}
.title{font-weight:700;font-size:18px;}
.sub{font-size:13px;color:var(--muted);}
label{display:block;font-size:13px;margin-top:6px;color:var(--muted);}
input[type="text"],input[type="number"],textarea,select{width:100%;padding:10px 12px;margin-top:6px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:var(--card);color:var(--text);outline:none;font-size:14px;}
textarea{resize:vertical;min-height:78px;max-height:180px;}
.row{display:flex;gap:8px;}
.row .col{flex:1;}
.mini{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:var(--card);}
.btn{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,0,0,0.06);}
.logo{width:96px;height:96px;border-radius:10px;background:linear-gradient(180deg,#111,#222);display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;border:1px solid rgba(0,0,0,0.06);}
.logo img{width:100%;height:100%;object-fit:cover;}
.stats{display:flex;gap:4px;flex-direction:column;}
.stat{font-size:13px;color:var(--muted);}
.inventory-header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.search{padding:8px 10px;border-radius:10px;width:220px;border:1px solid rgba(0,0,0,0.06);background:var(--card);color:var(--text);}
.grid{margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;}
.card{border-radius:10px;padding:12px;background:linear-gradient(180deg,var(--card), rgba(0,0,0,0.02));box-shadow:0 6px 18px var(--glass);display:flex;gap:10px;flex-direction:column;}
.card .top{display:flex;gap:10px;align-items:center;}
.card .meta{display:flex;flex-direction:column;gap:4px;flex:1;}
.name{font-weight:600;font-size:15px;}
.desc{font-size:12px;color:var(--muted);overflow:hidden;text-overflow:ellipsis;max-height:36px;}
.badge{padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px;display:inline-block;}
.r-common{color:#0f9d58;border:1px solid rgba(15,157,88,0.12);}
.r-rare{color:#1e88e5;border:1px solid rgba(30,136,229,0.12);}
.r-epic{color:#8e24aa;border:1px solid rgba(142,36,170,0.12);}
.r-leg{color:#fbc02d;border:1px solid rgba(251,192,45,0.12);}
.r-myth{color:#e53935;border:1px solid rgba(229,57,53,0.12);}
.r-dev-special{
  background: linear-gradient(90deg, red, yellow);
  -webkit-background-clip: text;
  color: transparent;
  font-weight: 800;
}
.card-footer{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:8px;}
.small{font-size:13px;color:var(--muted);}
.controls{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:6px;}
.muted{color:var(--muted);font-size:13px;}
.modal-back{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);z-index:30;padding:20px;}
.modal{width:100%;max-width:720px;background:var(--panel);border-radius:12px;padding:18px;box-shadow:0 18px 40px rgba(0,0,0,0.6);color:var(--text);}
.modal .row{align-items:flex-start;}
.modal .logo{width:160px;height:160px;}
.modal .details{flex:1;}
@media(max-width:980px){.app{grid-template-columns:1fr;padding-bottom:40px}.panel{order:2}}
</style>
</head>
<body data-theme="light">
<div class="app">
  <!-- LEFT: Company / Event -->
  <section class="panel">
    <div class="header">
      <div><div class="title">Make a Event 4.0</div><div class="sub">Capital: <span id="money">5000</span> €</div></div>
      <div><button id="themeToggle" class="btn btn-small">Mode Sombre</button></div>
    </div>

    <!-- Company creation -->
    <div id="companyPanel">
      <label>Nom de votre compagnie</label><input id="companyName" type="text" placeholder="Ex: Dev Events Inc">
      <label>Logo de la compagnie</label><input id="companyLogo" type="file" accept="image/*">
      <label>Description</label><textarea id="companyDesc" placeholder="Votre entreprise en quelques mots..."></textarea>
      <button id="btnCreateCompany" class="btn">Créer la compagnie</button>
    </div>

    <!-- Event creation (hidden au début) -->
    <div id="eventPanel" style="display:none;">
      <div class="preview mini">
        <div class="logo" id="previewLogo"><span style="opacity:0.35">Logo</span></div>
        <div class="stats">
          <div class="stat"><strong id="previewName">Nom de l'événement</strong></div>
          <div class="stat" id="previewType">Type — Commun</div>
          <div class="stat" id="previewProfit">Profit estimé: 0 €</div>
        </div>
      </div>
      <label>Nom</label><input id="inputName" type="text" placeholder="Ex : Summer Fest">
      <label>Logo (image)</label><input id="inputLogo" type="file" accept="image/*">
      <label>Description</label><textarea id="inputDesc" placeholder="Texte qui attire (max 200 signes)"></textarea>
      <div class="row">
        <div class="col"><label>Type d'événement</label><select id="inputType"><option value="concert">Concert</option><option value="conference">Conférence</option><option value="exposition">Exposition</option><option value="fete">Fête</option><option value="atelier">Atelier</option></select></div>
        <div class="col"><label>Prix du ticket (€)</label><input id="inputPrice" type="number" min="1" value="15"></div>
      </div>
      <label>Budget marketing (€)</label><input id="inputMarketing" type="number" min="0" value="50">
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="btnAdd" class="btn">Créer & Ajouter</button>
        <button id="btnPreview" class="btn ghost">Mettre à jour aperçu</button>
      </div>
      <div class="controls" style="margin-top:12px;"><div class="muted">Cartes sauvegardées : <span id="count">0</span></div></div>
    </div>
  </section>

  <!-- RIGHT: inventory -->
  <section>
    <div class="panel">
      <div class="inventory-header">
        <div><div class="title">Inventaire</div><div class="sub">Mes événements</div></div>
      </div>
      <div class="grid" id="grid"></div>
    </div>
  </section>
</div>

<!-- Modal details -->
<div class="modal-back" id="modal">
<div class="modal" role="dialog" aria-modal="true">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div style="font-weight:700" id="modalTitle">Détails événement</div>
    <div><button id="modalClose" class="btn ghost">Fermer</button></div>
  </div>
  <div class="row" style="margin-top:12px;">
    <div class="logo" id="modalLogo"></div>
    <div class="details">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
        <div><div class="name" id="modalName"></div><div class="small muted" id="modalType"></div></div>
        <div><div id="modalBadge" class="badge"></div></div>
      </div>
      <p style="margin-top:10px;color:var(--muted)" id="modalDesc"></p>
      <div style="display:flex;gap:12px;margin-top:12px;align-items:center;">
        <div><strong>Profit estimé:</strong> <span id="modalProfit"></span></div>
        <div><strong>Prix ticket:</strong> <span id="modalPrice"></span> €</div>
        <div><strong>Marketing:</strong> <span id="modalMarketing"></span> €</div>
        <div><strong>État:</strong> <span id="modalStatus">Arrêté</span></div>
      </div>
      <div style="display:flex;gap:8px;margin-top:14px;">
        <button id="btnDelete" class="btn ghost">Supprimer</button>
        <button id="btnToggle" class="btn">Lancer / Stop</button>
        <button id="btnClose" class="btn">Fermer</button>
      </div>
    </div>
  </div>
</div>
</div>

<script>
// ====== Logic ======
const LS_KEY = 'makeaevent4';
let collection = [], money = 5000, company = null;
const el={};
['inputName','inputLogo','inputDesc','inputType','inputPrice','inputMarketing','previewLogo','previewName','previewType','previewProfit','btnAdd','btnPreview','grid','count','modal','modalClose','modalTitle','modalLogo','modalName','modalType','modalDesc','modalProfit','modalPrice','modalMarketing','modalBadge','btnDelete','btnClose','btnToggle','companyPanel','eventPanel','companyName','companyLogo','companyDesc','btnCreateCompany','themeToggle','money','modalStatus'].forEach(id=>el[id]=document.getElementById(id));
let currentFileDataUrl = null, currentModalId = null;

// Company creation
el.btnCreateCompany.addEventListener('click',()=>{
  const name = el.companyName.value.trim(); if(!name) return alert('Nom obligatoire'); 
  const desc = el.companyDesc.value.trim(); 
  const logoFile = el.companyLogo.files[0]; 
  if(!logoFile) return alert('Logo obligatoire');
  const reader = new FileReader(); reader.onload = ev=>{
    company={name,desc,logo:ev.target.result}; 
    el.companyPanel.style.display='none'; 
    el.eventPanel.style.display='block'; 
    save();
  }; reader.readAsDataURL(logoFile);
});

// Logo preview
el.inputLogo.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f){ currentFileDataUrl=null; el.previewLogo.innerHTML='<span style="opacity:.35">Logo</span>'; return; }
  const reader = new FileReader(); reader.onload=ev=>{currentFileDataUrl=ev.target.result; el.previewLogo.innerHTML='<img src="'+currentFileDataUrl+'">';}
  reader.readAsDataURL(f);
});

// Utils
function uid(){ return 'ev_'+Math.random().toString(36).slice(2,9); }
const baseByType={concert:200,conference:120,exposition:150,fete:180,atelier:90};
function computeParticipants(type,desc,marketing,price){ const base=baseByType[type]||100; const attractivity=1+Math.min((desc||'').length/100,0.5)+Math.min(marketing/500,0.5); const priceEffect=Math.max(0.05,1.6-price/25); return Math.floor(base*attractivity*priceEffect);}
function computeProfit(type,desc,marketing,price){ const participants=computeParticipants(type,desc,marketing,price); const base=baseByType[type]||100; const costFixed=base*2; const profit=Math.max(0,Math.floor((participants*price)-marketing-costFixed)); return {participants,profit};}
function computeRarity(name,profit){ if(name.toLowerCase().includes('dev')) return 'dev-special'; if(profit>8000) return 'pro'; if(profit>4000) return 'rich'; if(profit>2000) return 'myth'; if(profit>1000) return 'leg'; if(profit>500) return 'epic'; if(profit>=200) return 'rare'; return 'common';}
function rarityLabel(r){ const map={common:'Commun',rare:'Rare',epic:'Épique',leg:'Légendaire',myth:'Mythique',rich:'Riche',pro:'Pro','dev-special':'Dev'}; return map[r]||r;}
function escapeHTML(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);}

function updatePreview(){ const name=el.inputName.value.trim()||'Nom de l\'événement'; const desc=el.inputDesc.value.trim()||''; const type=el.inputType.value; const price=Math.max(1,Number(el.inputPrice.value)||1); const marketing=Math.max(0,Number(el.inputMarketing.value)||0); const {participants,profit}=computeProfit(type,desc,marketing,price); const rarity=computeRarity(name,profit); el.previewName.textContent=name; el.previewType.textContent=type.charAt(0).toUpperCase()+type.slice(1)+' — '+rarityLabel(rarity); el.previewProfit.textContent=`Profit estimé: ${profit.toLocaleString()} €`; if(!currentFileDataUrl) el.previewLogo.innerHTML='<span style="opacity:.35">Logo</span>'; }
el.btnPreview.addEventListener('click',updatePreview);

// Save/load
function save(){localStorage.setItem(LS_KEY,JSON.stringify({collection,money,company})); render(); updateMoney();}
function load(){const raw=localStorage.getItem(LS_KEY); if(raw)try{const d=JSON.parse(raw); collection=d.collection||[]; money=d.money||5000; company=d.company||null; if(company){el.companyPanel.style.display='none'; el.eventPanel.style.display='block';} }catch(e){collection=[];money=5000; company=null;} render(); updateMoney(); }
function updateMoney(){el.money.textContent=money.toLocaleString();}

// Add event
el.btnAdd.addEventListener('click',()=>{
  if(!company){alert('Créer une compagnie d\'abord !'); return;}
  const name=el.inputName.value.trim(); if(!name)return alert('Nom obligatoire'); 
  const desc=el.inputDesc.value.trim(); 
  const type=el.inputType.value; 
  const price=Math.max(1,Number(el.inputPrice.value)||1); 
  const marketing=Math.max(0,Number(el.inputMarketing.value)||0); 
  const {participants,profit}=computeProfit(type,desc,marketing,price); 
  const rarity=computeRarity(name,profit);
  const item={id:uid(),name,desc,type,price,marketing,participants,profit,rarity,logo:currentFileDataUrl||null,status:'stopped'}; 
  collection.unshift(item); save(); el.inputName.value=''; el.inputDesc.value=''; el.inputPrice.value=15; el.inputMarketing.value=50; el.inputLogo.value=''; currentFileDataUrl=null; el.previewLogo.innerHTML='<span style="opacity:.35">Logo</span>'; updatePreview();
});

// Render
function makeBadgeHtml(r){if(r==='dev-special')return`<span class="r-dev-special">DEV</span>`; const cls={common:'r-common',rare:'r-rare',epic:'r-epic',leg:'r-leg',myth:'r-myth',rich:'r-rich',pro:'r-pro'}[r]||'r-common'; return `<span class="badge ${cls}">${rarityLabel(r)}</span>`;}
function render(){el.grid.innerHTML=''; collection.forEach(i=>{ const div=document.createElement('div'); div.className='card'; div.innerHTML=`<div class="top"><div class="logo">${i.logo?'<img src="'+i.logo+'">':'<span style="opacity:.35">Logo</span>'}</div><div class="meta"><div class="name">${escapeHTML(i.name)}</div><div class="desc">${escapeHTML(i.desc)}</div><div class="small">Participants: ${i.participants}</div></div></div><div class="card-footer">${makeBadgeHtml(i.rarity)} <button class="btn btn-small" onclick="showDetails('${i.id}')">Détails</button></div>`; el.grid.appendChild(div); }); el.count.textContent=collection.length;}

// Modal
window.showDetails=function(id){currentModalId=id; const i=collection.find(x=>x.id===id); if(!i)return; el.modalTitle.textContent=i.name; el.modalName.textContent=i.name; el.modalType.textContent=i.type+' — '+rarityLabel(i.rarity); el.modalDesc.textContent=i.desc; el.modalProfit.textContent=i.profit.toLocaleString()+' €'; el.modalPrice.textContent=i.price; el.modalMarketing.textContent=i.marketing; el.modalBadge.innerHTML=makeBadgeHtml(i.rarity); el.modalLogo.innerHTML=i.logo?'<img src="'+i.logo+'">':'<span style="opacity:.35">Logo</span>'; el.modalStatus.textContent=i.status==='running'?'En cours':'Arrêté'; el.modal.style.display='flex';}
el.modalClose.onclick=()=>el.modal.style.display='none';
el.btnClose.onclick=()=>el.modal.style.display='none';
el.btnDelete.onclick=()=>{if(!currentModalId)return; collection=collection.filter(x=>x.id!==currentModalId); save(); el.modal.style.display='none';}
el.btnToggle.onclick=()=>{if(!currentModalId)return; const i=collection.find(x=>x.id===currentModalId); if(!i)return; if(i.status==='stopped'){ const cost=i.price+i.marketing; if(cost>money){alert('Pas assez d’argent'); return;} money-=cost; i.status='running'; alert(`Événement lancé !`);} else { i.status='stopped'; alert('Événement arrêté'); } save(); el.modalStatus.textContent=i.status==='running'?'En cours':'Arrêté'; save();}

// Theme
el.themeToggle.addEventListener('click',()=>{ const t=document.body.getAttribute('data-theme')==='light'?'dark':'light'; document.body.setAttribute('data-theme',t); el.themeToggle.textContent=t==='dark'?'Mode Clair':'Mode Sombre';});

load();
updatePreview();
</script>
</body>
</html>
